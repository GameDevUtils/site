version: 2
jobs:
  build:
    docker:
      - image: circleci/ruby:2.4.1-node
    environment:
      - NOKOGIRI_USE_SYSTEM_LIBRARIES: true
    branches:
      only:
        - master
    steps:
      - checkout
      - run:
          name: ensure cmake is installed (assumes debian image)
          command: |
            cat /etc/issue
            sudo apt-get install cmake
#      - run:
#          name: ensure csslint is installed
#          command: |
#            sudo npm install -g csslint
#            csslint --version
      - run:
          name: ensure commonmarker is installed
          command: |
            cd docs/
            gem install commonmarker -v '0.17.6'
      - run:
          name: ensure bundler is up-to-date
          command: gem install bundler
      - run: # https://github.com/github/pages-gem ][ https://github.com/gjtorikian/html-proofer
          name: ensure Jekyll and html-proofer is installed
          command: |
            cd docs/
            bundle install
      - run:
          name: build static pages
          command: |
            cd docs/
            bundle exec jekyll build
      - run:
          name: validate static pages
          command: |
            cd docs/
            bundle exec htmlproofer ./_site --only-4xx --check-favicon --check-html

      # TODO - ADD to CI (!): css linter [https://github.com/CSSLint/csslint/wiki/Command-line-interface]
      # TODO - ADD to CI (!): js/es linter [ ??? ]
      # TODO - ADD to CI (!): jsx linter [ ??? ]
      # TODO - ADD to CI (?): accessibility checker [https://github.com/pa11y/pa11y-ci]
      # TODO - ADD to BUILD (!): coverage (as npm run script / as CI)
      # TODO - ADD to BUILD (?): css reset (as npm run script) [https://github.com/necolas/normalize.css]
      # TODO - ADD to BUILD (?): prettifier (as npm run script) [ ??? ]